<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASCII Art Logo Converter</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gif.js/0.2.0/gif.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-content {
            padding: 30px;
        }

        .input-section {
            margin-bottom: 30px;
        }

        .input-section h3 {
            margin-bottom: 15px;
            color: #333;
            font-size: 1.2em;
        }

        .code-input {
            width: 100%;
            height: 200px;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            resize: vertical;
            transition: border-color 0.3s;
        }

        .code-input:focus {
            outline: none;
            border-color: #4facfe;
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
        }

        .sample-buttons {
            margin: 15px 0;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .sample-btn {
            padding: 8px 16px;
            background: #f0f0f0;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .sample-btn:hover {
            background: #4facfe;
            color: white;
            transform: translateY(-2px);
        }

        .preview-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .preview-container {
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            background: #f9f9f9;
            min-height: 300px;
        }

        .preview-container h3 {
            margin-bottom: 15px;
            color: #333;
        }

        .ascii-preview {
            font-family: 'Courier New', monospace;
            font-size: 16px;
            line-height: 1.2;
            white-space: pre;
            background: white;
            padding: 20px;
            border-radius: 5px;
            border: 1px solid #ddd;
            min-height: 200px;
            overflow: auto;
        }

        .canvas-container {
            text-align: center;
        }

        #preview-canvas {
            border: 1px solid #ddd;
            border-radius: 5px;
            background: white;
            max-width: 100%;
            height: auto;
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .control-group {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .control-group h4 {
            margin-bottom: 15px;
            color: #495057;
            font-size: 1.1em;
        }

        .theme-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .theme-option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .theme-option:hover {
            background: rgba(79, 172, 254, 0.1);
        }

        .theme-option input[type="radio"] {
            margin: 0;
        }

        .animation-controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .checkbox-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .speed-control {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .speed-slider {
            width: 100%;
        }

        .custom-colors {
            padding: 15px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 8px;
            border: 1px dashed #ccc;
        }

        .color-picker-group {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .color-picker-group:last-child {
            margin-bottom: 0;
        }

        .color-picker-group label {
            font-weight: 500;
            color: #495057;
            min-width: 80px;
        }

        .color-picker-wrapper {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .color-picker-wrapper input[type="color"] {
            width: 40px;
            height: 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            padding: 0;
        }

        .color-picker-wrapper input[type="color"]::-webkit-color-swatch-wrapper {
            padding: 0;
        }

        .color-picker-wrapper input[type="color"]::-webkit-color-swatch {
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .color-preview {
            font-family: 'Courier New', monospace;
            font-size: 12px;
            color: #666;
            min-width: 60px;
            text-align: center;
        }

        .download-section {
            text-align: center;
            padding: 30px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .download-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .download-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 150px;
        }

        .download-btn.primary {
            background: linear-gradient(45deg, #4facfe, #00f2fe);
            color: white;
        }

        .download-btn.secondary {
            background: linear-gradient(45deg, #43e97b, #38f9d7);
            color: white;
        }

        .download-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .download-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .error-message {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            border-left: 4px solid #c62828;
            display: none;
        }

        .typing-animation {
            border-right: 2px solid #333;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 50% { border-right-color: transparent; }
            51%, 100% { border-right-color: #333; }
        }

        @media (max-width: 768px) {
            .preview-section {
                grid-template-columns: 1fr;
            }
            
            .controls {
                grid-template-columns: 1fr;
            }
            
            .download-buttons {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé® ASCII Art Logo Converter</h1>
            <p>C Ïñ∏Ïñ¥ printf ÏïÑÏä§ÌÇ§ÏïÑÌä∏Î•º Î©ãÏßÑ ÌîÑÎ°úÌïÑ Ïù¥ÎØ∏ÏßÄÎ°ú Î≥ÄÌôòÌïòÏÑ∏Ïöî!</p>
        </div>

        <div class="main-content">
            <!-- Input Section -->
            <div class="input-section">
                <h3>üìù C ÏΩîÎìú ÏûÖÎ†•</h3>
                <textarea 
                    id="code-input" 
                    class="code-input" 
                    placeholder='printf("  /\\_/\\  \n");&#10;printf(" ( o.o ) \n");&#10;printf("  > ^ <  \n");&#10;printf("  Í≥†ÏñëÏù¥  \n");'
                ></textarea>
                
                <div class="sample-buttons">
                    <button class="sample-btn" data-sample="cat">üê± Í≥†ÏñëÏù¥</button>
                    <button class="sample-btn" data-sample="heart">‚ù§Ô∏è ÌïòÌä∏</button>
                    <button class="sample-btn" data-sample="star">‚≠ê Î≥Ñ</button>
                    <button class="sample-btn" data-sample="house">üè† Ïßë</button>
                    <button class="sample-btn" data-sample="smile">üòä ÏõÉÎäîÏñºÍµ¥</button>
                </div>
                
                <div id="error-message" class="error-message"></div>
            </div>

            <!-- Preview Section -->
            <div class="preview-section">
                <div class="preview-container">
                    <h3>üì∫ ÌÖçÏä§Ìä∏ ÎØ∏Î¶¨Î≥¥Í∏∞</h3>
                    <div id="ascii-preview" class="ascii-preview"></div>
                </div>
                
                <div class="preview-container">
                    <h3>üñºÔ∏è Ïù¥ÎØ∏ÏßÄ ÎØ∏Î¶¨Î≥¥Í∏∞</h3>
                    <div class="canvas-container">
                        <canvas id="preview-canvas" width="512" height="512"></canvas>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls">
                <div class="control-group">
                    <h4>üé® ÏÉâÏÉÅ ÌÖåÎßà</h4>
                    <div class="theme-options">
                        <label class="theme-option">
                            <input type="radio" name="theme" value="dark-light" checked>
                            <span>Í≤ÄÏùÄ Í∏ÄÏî® / Ìù∞ Î∞∞Í≤Ω</span>
                        </label>
                        <label class="theme-option">
                            <input type="radio" name="theme" value="green-dark">
                            <span>Ï¥àÎ°ù Í∏ÄÏî® / Í≤ÄÏùÄ Î∞∞Í≤Ω</span>
                        </label>
                        <label class="theme-option">
                            <input type="radio" name="theme" value="light-dark">
                            <span>Ìù∞ Í∏ÄÏî® / Í≤ÄÏùÄ Î∞∞Í≤Ω</span>
                        </label>
                        <label class="theme-option">
                            <input type="radio" name="theme" value="custom">
                            <span>Ïª§Ïä§ÌÖÄ ÏÉâÏÉÅ</span>
                        </label>
                    </div>
                    
                    <div class="custom-colors" id="custom-colors" style="margin-top: 15px; display: none;">
                        <div class="color-picker-group">
                            <label for="text-color">Í∏ÄÏî® ÏÉâÏÉÅ:</label>
                            <div class="color-picker-wrapper">
                                <input type="color" id="text-color" value="#000000">
                                <span class="color-preview" id="text-color-preview">#000000</span>
                            </div>
                        </div>
                        <div class="color-picker-group">
                            <label for="bg-color">Î∞∞Í≤Ω ÏÉâÏÉÅ:</label>
                            <div class="color-picker-wrapper">
                                <input type="color" id="bg-color" value="#ffffff">
                                <span class="color-preview" id="bg-color-preview">#ffffff</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="control-group">
                    <h4>‚ú® Ïï†ÎãàÎ©îÏù¥ÏÖò</h4>
                    <div class="animation-controls">
                        <label class="checkbox-wrapper">
                            <input type="checkbox" id="animation-enabled">
                            <span>ÌÉÄÏù¥Ìïë Ïï†ÎãàÎ©îÏù¥ÏÖò</span>
                        </label>
                        
                        <div class="speed-control">
                            <label>Ïï†ÎãàÎ©îÏù¥ÏÖò ÏÜçÎèÑ</label>
                            <input type="range" id="animation-speed" class="speed-slider" min="50" max="500" value="100">
                            <span id="speed-display">Î≥¥ÌÜµ</span>
                        </div>
                    </div>
                </div>

                <div class="control-group">
                    <h4>üìè Ïù¥ÎØ∏ÏßÄ ÌÅ¨Í∏∞</h4>
                    <select id="image-size">
                        <option value="512">512x512 (Í∏∞Î≥∏)</option>
                        <option value="1024">1024x1024 (Í≥†ÌôîÏßà)</option>
                        <option value="256">256x256 (ÏûëÏùÄ ÌÅ¨Í∏∞)</option>
                    </select>
                </div>
            </div>

            <!-- Download Section -->
            <div class="download-section">
                <h3>üíæ Îã§Ïö¥Î°úÎìú</h3>
                <div class="download-buttons">
                    <button id="download-png" class="download-btn primary">PNG Îã§Ïö¥Î°úÎìú</button>
                    <button id="download-gif" class="download-btn secondary">
                        <span class="btn-text">GIF Îã§Ïö¥Î°úÎìú</span>
                        <span class="btn-loading" style="display: none;">ÏÉùÏÑ± Ï§ë...</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        class ASCIIArtConverter {
            constructor() {
                this.canvas = document.getElementById('preview-canvas');
                this.ctx = this.canvas.getContext('2d');
                this.codeInput = document.getElementById('code-input');
                this.asciiPreview = document.getElementById('ascii-preview');
                this.errorMessage = document.getElementById('error-message');
                
                this.currentTheme = 'dark-light';
                this.animationEnabled = false;
                this.animationSpeed = 100;
                this.customTextColor = '#000000';
                this.customBgColor = '#ffffff';
                
                this.sampleCodes = {
                    cat: 'printf("  /\\_/\\\\  \\n");\nprintf(" ( o.o ) \\n");\nprintf("  > ^ <  \\n");\nprintf("  Í≥†ÏñëÏù¥  \\n");',
                    heart: 'printf("  ‚ô•‚ô•‚ô•‚ô•‚ô•  \\n");\nprintf(" ‚ô•‚ô•‚ô•‚ô•‚ô•‚ô•‚ô• \\n");\nprintf("  ‚ô•‚ô•‚ô•‚ô•‚ô•  \\n");\nprintf("   ‚ô•‚ô•‚ô•   \\n");\nprintf("    ‚ô•    \\n");',
                    star: 'printf("    *    \\n");\nprintf("   ***   \\n");\nprintf("  *****  \\n");\nprintf(" ******* \\n");\nprintf("*********\\n");',
                    house: 'printf("   /\\\\   \\n");\nprintf("  /  \\\\  \\n");\nprintf(" /____\\\\ \\n");\nprintf(" |    | \\n");\nprintf(" |____|\\n");',
                    smile: 'printf("  ****  \\n");\nprintf(" *    * \\n");\nprintf("* ^  ^ *\\n");\nprintf("*      *\\n");\nprintf("* \\\\__/ *\\n");\nprintf(" *    * \\n");\nprintf("  ****  \\n");'
                };
                
                // ÎùºÏù¥Î∏åÎü¨Î¶¨ Î°úÎî© ÌôïÏù∏
                this.checkLibraries();
                this.initializeEventListeners();
                this.updatePreview();
            }

            checkLibraries() {
                // GIF ÎùºÏù¥Î∏åÎü¨Î¶¨ Î°úÎî© ÌôïÏù∏
                if (typeof GIF === 'undefined') {
                    console.warn('GIF library not loaded yet. GIF functionality will be disabled.');
                    setTimeout(() => this.checkLibraries(), 1000); // 1Ï¥à ÌõÑ Ïû¨ÌôïÏù∏
                } else {
                    console.log('GIF library loaded successfully');
                }
            }

            initializeEventListeners() {
                // Code input change
                this.codeInput.addEventListener('input', () => this.updatePreview());
                
                // Sample buttons
                document.querySelectorAll('.sample-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const sample = e.target.dataset.sample;
                        this.codeInput.value = this.sampleCodes[sample];
                        this.updatePreview();
                    });
                });
                
                // Theme change
                document.querySelectorAll('input[name="theme"]').forEach(radio => {
                    radio.addEventListener('change', (e) => {
                        this.currentTheme = e.target.value;
                        this.toggleCustomColors(e.target.value === 'custom');
                        this.updatePreview();
                    });
                });
                
                // Custom color pickers
                document.getElementById('text-color').addEventListener('input', (e) => {
                    this.customTextColor = e.target.value;
                    document.getElementById('text-color-preview').textContent = e.target.value.toUpperCase();
                    if (this.currentTheme === 'custom') {
                        this.updatePreview();
                    }
                });
                
                document.getElementById('bg-color').addEventListener('input', (e) => {
                    this.customBgColor = e.target.value;
                    document.getElementById('bg-color-preview').textContent = e.target.value.toUpperCase();
                    if (this.currentTheme === 'custom') {
                        this.updatePreview();
                    }
                });
                
                // Auto-switch to custom when color picker is clicked
                document.getElementById('text-color').addEventListener('click', () => {
                    document.querySelector('input[value="custom"]').checked = true;
                    this.currentTheme = 'custom';
                    this.toggleCustomColors(true);
                    this.updatePreview();
                });
                
                document.getElementById('bg-color').addEventListener('click', () => {
                    document.querySelector('input[value="custom"]').checked = true;
                    this.currentTheme = 'custom';
                    this.toggleCustomColors(true);
                    this.updatePreview();
                });
                
                // Animation controls
                document.getElementById('animation-enabled').addEventListener('change', (e) => {
                    this.animationEnabled = e.target.checked;
                    this.updatePreview();
                });
                
                document.getElementById('animation-speed').addEventListener('input', (e) => {
                    this.animationSpeed = parseInt(e.target.value);
                    const speedDisplay = document.getElementById('speed-display');
                    if (this.animationSpeed < 120) speedDisplay.textContent = 'Îπ†Î¶Ñ';
                    else if (this.animationSpeed > 180) speedDisplay.textContent = 'ÎäêÎ¶º';
                    else speedDisplay.textContent = 'Î≥¥ÌÜµ';
                    
                    if (this.animationEnabled) this.updatePreview();
                });
                
                // Image size change
                document.getElementById('image-size').addEventListener('change', () => {
                    this.updateCanvasSize();
                    this.updatePreview();
                });
                
                // Download buttons
                document.getElementById('download-png').addEventListener('click', () => this.downloadPNG());
                document.getElementById('download-gif').addEventListener('click', () => this.downloadGIF());
            }

            parseCode(cCode) {
                try {
                    const printfPattern = /printf\s*\(\s*"([^"\\]*(\\.[^"\\]*)*)"\s*\)\s*;?/g;
                    let output = "";
                    let match;
                    
                    while ((match = printfPattern.exec(cCode)) !== null) {
                        let text = match[1]
                            .replace(/\\n/g, '\n')
                            .replace(/\\t/g, '\t')
                            .replace(/\\"/g, '"')
                            .replace(/\\\\/g, '\\');
                        output += text;
                    }
                    
                    if (output === "" && cCode.includes('printf')) {
                        throw new Error('printfÎ¨∏Ïùò Î¨∏Î≤ïÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî. Îî∞Ïò¥ÌëúÍ∞Ä Ï†úÎåÄÎ°ú Îã´ÌòîÎäîÏßÄ ÌôïÏù∏ÌïòÏÑ∏Ïöî.');
                    }
                    
                    if (output === "") {
                        throw new Error('printfÎ¨∏ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                    }
                    
                    // ÎÑàÎ¨¥ Í∏¥ Ï∂úÎ†• Ï†úÌïú
                    const lines = output.split('\n');
                    if (lines.length > 50) {
                        throw new Error('Ï∂úÎ†•Ïù¥ ÎÑàÎ¨¥ ÍπÅÎãàÎã§. 50Ï§Ñ Ïù¥ÌïòÎ°ú Ï†úÌïúÌï¥Ï£ºÏÑ∏Ïöî.');
                    }
                    
                    this.hideError();
                    return output;
                    
                } catch (error) {
                    this.showError(error.message);
                    return "";
                }
            }

            showError(message) {
                this.errorMessage.textContent = message;
                this.errorMessage.style.display = 'block';
            }

            hideError() {
                this.errorMessage.style.display = 'none';
            }

            updatePreview() {
                const code = this.codeInput.value.trim();
                const parsedOutput = this.parseCode(code);
                
                if (parsedOutput) {
                    if (this.animationEnabled) {
                        this.animateText(parsedOutput);
                    } else {
                        this.asciiPreview.textContent = parsedOutput;
                        this.asciiPreview.classList.remove('typing-animation');
                    }
                    this.renderToCanvas(parsedOutput);
                } else {
                    this.asciiPreview.textContent = "";
                    this.clearCanvas();
                }
            }

            animateText(fullText) {
                this.asciiPreview.textContent = "";
                this.asciiPreview.classList.add('typing-animation');
                
                let currentIndex = 0;
                const animate = () => {
                    if (currentIndex < fullText.length) {
                        this.asciiPreview.textContent = fullText.substring(0, currentIndex + 1);
                        currentIndex++;
                        setTimeout(animate, this.animationSpeed);
                    } else {
                        this.asciiPreview.classList.remove('typing-animation');
                    }
                };
                animate();
            }

            getThemeColors() {
                const themes = {
                    'dark-light': { text: '#000000', bg: '#ffffff' },
                    'green-dark': { text: '#00ff00', bg: '#000000' },
                    'light-dark': { text: '#ffffff', bg: '#000000' },
                    'custom': { text: this.customTextColor, bg: this.customBgColor }
                };
                return themes[this.currentTheme];
            }

            toggleCustomColors(show) {
                const customColorsDiv = document.getElementById('custom-colors');
                customColorsDiv.style.display = show ? 'block' : 'none';
            }

            updateCanvasSize() {
                const size = parseInt(document.getElementById('image-size').value);
                this.canvas.width = size;
                this.canvas.height = size;
            }

            renderToCanvas(text) {
                const colors = this.getThemeColors();
                
                // Clear canvas
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                
                // Fill background
                this.ctx.fillStyle = colors.bg;
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                
                if (!text) return;
                
                // Calculate font size
                const lines = text.split('\n');
                const maxLines = lines.length;
                const maxChars = Math.max(...lines.map(line => line.length));
                
                const fontSize = Math.min(
                    Math.floor((this.canvas.width * 0.8) / maxChars * 1.2),
                    Math.floor((this.canvas.height * 0.8) / maxLines)
                );
                
                this.ctx.font = `${fontSize}px "Courier New", monospace`;
                this.ctx.fillStyle = colors.text;
                this.ctx.textAlign = 'center';
                this.ctx.textBaseline = 'middle';
                
                // Calculate starting position
                const lineHeight = fontSize * 1.2;
                const totalHeight = maxLines * lineHeight;
                const startY = (this.canvas.height - totalHeight) / 2 + lineHeight / 2;
                
                // Draw text
                lines.forEach((line, index) => {
                    const y = startY + index * lineHeight;
                    this.ctx.fillText(line, this.canvas.width / 2, y);
                });
            }

            clearCanvas() {
                const colors = this.getThemeColors();
                this.ctx.fillStyle = colors.bg;
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
            }

            downloadPNG() {
                try {
                    const code = this.codeInput.value.trim();
                    const parsedOutput = this.parseCode(code);
                    
                    if (!parsedOutput) {
                        alert('Îã§Ïö¥Î°úÎìúÌï† ÎÇ¥Ïö©Ïù¥ ÏóÜÏäµÎãàÎã§. ÏΩîÎìúÎ•º Î®ºÏ†Ä ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                        return;
                    }
                    
                    // Create download canvas with current settings
                    const downloadCanvas = document.createElement('canvas');
                    const size = parseInt(document.getElementById('image-size').value);
                    downloadCanvas.width = size;
                    downloadCanvas.height = size;
                    const downloadCtx = downloadCanvas.getContext('2d');
                    
                    // Render the image
                    const colors = this.getThemeColors();
                    downloadCtx.fillStyle = colors.bg;
                    downloadCtx.fillRect(0, 0, size, size);
                    
                    if (parsedOutput) {
                        const lines = parsedOutput.split('\n');
                        const maxLines = lines.length;
                        const maxChars = Math.max(...lines.map(line => line.length));
                        
                        const fontSize = Math.min(
                            Math.floor((size * 0.8) / maxChars * 1.2),
                            Math.floor((size * 0.8) / maxLines)
                        );
                        
                        downloadCtx.font = `${fontSize}px "Courier New", monospace`;
                        downloadCtx.fillStyle = colors.text;
                        downloadCtx.textAlign = 'center';
                        downloadCtx.textBaseline = 'middle';
                        
                        const lineHeight = fontSize * 1.2;
                        const totalHeight = maxLines * lineHeight;
                        const startY = (size - totalHeight) / 2 + lineHeight / 2;
                        
                        lines.forEach((line, index) => {
                            const y = startY + index * lineHeight;
                            downloadCtx.fillText(line, size / 2, y);
                        });
                    }
                    
                    // Download
                    downloadCanvas.toBlob((blob) => {
                        if (blob) {
                            const url = URL.createObjectURL(blob);
                            const a = document.createElement('a');
                            a.href = url;
                            a.download = 'my_ascii_logo.png';
                            document.body.appendChild(a);
                            a.click();
                            document.body.removeChild(a);
                            URL.revokeObjectURL(url);
                        } else {
                            alert('PNG ÏÉùÏÑ±Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
                        }
                    }, 'image/png');
                    
                } catch (error) {
                    console.error('PNG Îã§Ïö¥Î°úÎìú Ïò§Î•ò:', error);
                    alert('PNG Îã§Ïö¥Î°úÎìú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                }
            }

            async downloadGIF() {
                try {
                    // GIF ÎùºÏù¥Î∏åÎü¨Î¶¨ Î°úÎî© ÌôïÏù∏
                    if (typeof GIF === 'undefined') {
                        alert('GIF ÎùºÏù¥Î∏åÎü¨Î¶¨Í∞Ä ÏïÑÏßÅ Î°úÎî©ÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§. Ïû†Ïãú ÌõÑ Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.');
                        return;
                    }

                    const code = this.codeInput.value.trim();
                    const parsedOutput = this.parseCode(code);
                    
                    if (!parsedOutput) {
                        alert('Îã§Ïö¥Î°úÎìúÌï† ÎÇ¥Ïö©Ïù¥ ÏóÜÏäµÎãàÎã§. ÏΩîÎìúÎ•º Î®ºÏ†Ä ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                        return;
                    }
                    
                    const gifButton = document.getElementById('download-gif');
                    const btnText = gifButton.querySelector('.btn-text');
                    const btnLoading = gifButton.querySelector('.btn-loading');
                    
                    // UI Î°úÎî© ÏÉÅÌÉú
                    gifButton.disabled = true;
                    if (btnText) btnText.style.display = 'none';
                    if (btnLoading) btnLoading.style.display = 'inline';
                    
                    const blob = await this.generateGIF(parsedOutput);
                    
                    // Îã§Ïö¥Î°úÎìú
                    if (blob) {
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = 'my_ascii_logo.gif';
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        URL.revokeObjectURL(url);
                    } else {
                        throw new Error('GIF ÏÉùÏÑ±Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
                    }
                    
                } catch (error) {
                    console.error('GIF ÏÉùÏÑ± Ïò§Î•ò:', error);
                    alert(`GIF ÏÉùÏÑ± Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ${error.message}`);
                } finally {
                    // UI ÏõêÏÉÅÎ≥µÍµ¨
                    const gifButton = document.getElementById('download-gif');
                    const btnText = gifButton.querySelector('.btn-text');
                    const btnLoading = gifButton.querySelector('.btn-loading');
                    
                    gifButton.disabled = false;
                    if (btnText) btnText.style.display = 'inline';
                    if (btnLoading) btnLoading.style.display = 'none';
                }
            }

            async generateGIF(text) {
                return new Promise((resolve, reject) => {
                    try {
                        const size = parseInt(document.getElementById('image-size').value);
                        const colors = this.getThemeColors();
                        
                        // GIF ÏÑ§Ï†ï
                        const gif = new GIF({
                            workers: 2,
                            quality: 10,
                            width: size,
                            height: size,
                            transparent: colors.bg === '#ffffff' || colors.bg.toLowerCase() === '#ffffff' ? null : 0x000000,
                            repeat: 0 // Î¨¥Ìïú Î∞òÎ≥µ
                        });
                        
                        // Ïï†ÎãàÎ©îÏù¥ÏÖò ÌîÑÎ†àÏûÑ ÏÉùÏÑ±
                        const frames = this.generateAnimationFrames(text, size);
                        
                        // Í∞Å ÌîÑÎ†àÏûÑÏùÑ GIFÏóê Ï∂îÍ∞Ä
                        frames.forEach((frameCanvas, index) => {
                            const delay = index === frames.length - 1 ? 1500 : this.animationSpeed;
                            gif.addFrame(frameCanvas, { delay, copy: true });
                        });
                        
                        // GIF Î†åÎçîÎßÅ Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà
                        gif.on('finished', (blob) => {
                            resolve(blob);
                        });
                        
                        gif.on('abort', () => {
                            reject(new Error('GIF ÏÉùÏÑ±Ïù¥ Ï§ëÎã®ÎêòÏóàÏäµÎãàÎã§.'));
                        });
                        
                        gif.on('progress', (p) => {
                            console.log('GIF ÏÉùÏÑ± ÏßÑÌñâÎ•†:', Math.round(p * 100) + '%');
                        });
                        
                        // Î†åÎçîÎßÅ ÏãúÏûë
                        gif.render();
                        
                    } catch (error) {
                        reject(error);
                    }
                });
            }

            generateAnimationFrames(text, size) {
                const colors = this.getThemeColors();
                const frames = [];
                
                // ÌÖçÏä§Ìä∏Î•º Î¨∏Ïûê Îã®ÏúÑÎ°ú Î∂ÑÌï†
                const characters = text.split('');
                
                // Í∞Å Îã®Í≥ÑÎ≥Ñ ÌîÑÎ†àÏûÑ ÏÉùÏÑ± (Î¨∏Ïûê ÌïòÎÇòÏî© Ï∂îÍ∞Ä)
                for (let i = 0; i <= characters.length; i++) {
                    const partialText = characters.slice(0, i).join('');
                    const frameCanvas = this.createFrameCanvas(partialText, size, colors);
                    frames.push(frameCanvas);
                }
                
                return frames;
            }

            createFrameCanvas(text, size, colors) {
                const canvas = document.createElement('canvas');
                canvas.width = size;
                canvas.height = size;
                const ctx = canvas.getContext('2d');
                
                // Î∞∞Í≤Ω Ï±ÑÏö∞Í∏∞
                ctx.fillStyle = colors.bg;
                ctx.fillRect(0, 0, size, size);
                
                if (!text) return canvas;
                
                // ÌÖçÏä§Ìä∏ Î†åÎçîÎßÅ
                const lines = text.split('\n');
                const maxLines = lines.length;
                const maxChars = Math.max(...lines.map(line => line.length));
                
                const fontSize = Math.min(
                    Math.floor((size * 0.8) / maxChars * 1.2),
                    Math.floor((size * 0.8) / maxLines)
                );
                
                ctx.font = `${fontSize}px "Courier New", monospace`;
                ctx.fillStyle = colors.text;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                
                const lineHeight = fontSize * 1.2;
                const totalHeight = maxLines * lineHeight;
                const startY = (size - totalHeight) / 2 + lineHeight / 2;
                
                lines.forEach((line, index) => {
                    const y = startY + index * lineHeight;
                    ctx.fillText(line, size / 2, y);
                });
                
                // ÌÉÄÏù¥Ìïë Ïª§ÏÑú Ï∂îÍ∞Ä (ÎßàÏßÄÎßâ Î¨∏ÏûêÍ∞Ä Í∞úÌñâÏù¥ ÏïÑÎãê Îïå)
                if (text.length > 0 && !text.endsWith('\n')) {
                    const lastLine = lines[lines.length - 1];
                    const lastLineY = startY + (lines.length - 1) * lineHeight;
                    
                    // Ïª§ÏÑú ÏúÑÏπò Í≥ÑÏÇ∞
                    const textWidth = ctx.measureText(lastLine).width;
                    const cursorX = size / 2 + textWidth / 2 + 5;
                    
                    ctx.fillRect(cursorX, lastLineY - fontSize / 2, 2, fontSize);
                }
                
                return canvas;
            }
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            new ASCIIArtConverter();
        });
    </script>
</body>
</html>
